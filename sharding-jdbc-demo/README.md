# Sharding JDBC - 分库分表

## 方式

+ 垂直拆分
  + 分库
  + 分表
+ 水平拆分
  + 分库
  + 分表

### 垂直分表

业务表拆分为`主表`+`附表`

主表包含主要字段(列表查询字段), 附表包含非常用信息(详情页字段)

1. 避免单表占用磁盘过多/IO过大
2. 修改字段时, 锁表或锁行时影响更少

### 垂直分库

把单一数据库, 按照业务进行划分, 专库专表

### 水平分表

### 水平分库

## 原则 




> 单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表
> 
> 如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表




每写一个sql都要考虑sql是怎么执行的

避免虚拟列查询, 会导致全分片查询

第一要务, 表数据分配均匀

时间分片,数据峰值不固定

## 分库分表策略


### inline策略 - 单一键分片
尽量不要用in (id1,id2,id3) , 确保id都在一个分片中, 否则会全分片表扫描
无法使用between查询, 需要单独配置允许范围查询 - 全分片表扫描


### complex策略 按多个分片键分片


### class_base策略 定制一个复杂的类实现分片策略

海量数据场景下, 不要使用存储过程


可分多个策略, 一个策略用于插入, 其他策略用于查询


mp 字段名尽量不要用id, 用了id, 默认吧id作为主键, 默认生成雪花算法, 不会将id交由shardingJDBC处理